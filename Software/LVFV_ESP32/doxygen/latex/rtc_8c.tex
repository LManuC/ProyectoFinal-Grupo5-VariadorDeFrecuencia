\doxysection{Referencia del archivo C\+:/\+Users/\+User/\+LVFV\+\_\+\+ESP32/main/rtc/rtc.c}
\hypertarget{rtc_8c}{}\label{rtc_8c}\index{C:/Users/User/LVFV\_ESP32/main/rtc/rtc.c@{C:/Users/User/LVFV\_ESP32/main/rtc/rtc.c}}


Funciones de lectura y escritura del RTC y alarmas.  


{\ttfamily \#include $<$sys/time.\+h$>$}\newline
{\ttfamily \#include "{}sdkconfig.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+err.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+timer.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+log.\+h"{}}\newline
{\ttfamily \#include "{}../system/sys\+Control.\+h"{}}\newline
{\ttfamily \#include "{}RTC.\+h"{}}\newline
\doxysubsubsection*{Estructuras de datos}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structrtc__alarms__t}{rtc\+\_\+alarms\+\_\+t}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Funciones}
\begin{DoxyCompactItemize}
\item 
static esp\+\_\+err\+\_\+t \mbox{\hyperlink{rtc_8c_ab576cf2b5649a8f5af8c1eca26c1e01a}{program\+\_\+alarm}} (esp\+\_\+timer\+\_\+handle\+\_\+t \texorpdfstring{$\ast$}{*}timer\+\_\+handle, void(\texorpdfstring{$\ast$}{*}callback)(void \texorpdfstring{$\ast$}{*}), int hour, int minute, const char \texorpdfstring{$\ast$}{*}name)
\begin{DoxyCompactList}\small\item\em Función dedicada a programar la alarma según hour y minute. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{rtc_8c_ae9adc0a6f5c490088bf65676a23ef49e}{alarm\+\_\+start\+\_\+cb}} (void \texorpdfstring{$\ast$}{*}arg)
\begin{DoxyCompactList}\small\item\em Función programada como alarma para iniciar el funcionamiento del motor. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{rtc_8c_ae1c6ac7aa77f0274bbdb795eab58f081}{alarm\+\_\+stop\+\_\+cb}} (void \texorpdfstring{$\ast$}{*}arg)
\begin{DoxyCompactList}\small\item\em Función programada como alarma para finalizar el funcionamiento del motor. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{rtc_8c_ae110c54d6d4dcbd67211a1ac02cdc222}{init\+RTC}} ()
\begin{DoxyCompactList}\small\item\em Inicializa el RTC en la hora 00\+:00\+:00. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{rtc_8c_a18ec0d194dc994434090b873251093b0}{set\+Time}} (struct tm \texorpdfstring{$\ast$}{*}setting\+\_\+time)
\begin{DoxyCompactList}\small\item\em Inicializa el RTC en la hora cargada en setting\+\_\+time. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{rtc_8c_a044acdfeee0cbf154bb9679e46b9bcf9}{get\+Time}} (struct tm \texorpdfstring{$\ast$}{*}current\+\_\+timeinfo)
\begin{DoxyCompactList}\small\item\em Carga la hora actuak desde el RTC del ESP32. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{rtc_8c_adb9ac05b0bcd1cc3769f8a9931d90c06}{rtc\+\_\+schedule\+\_\+alarms}} (\mbox{\hyperlink{structtime__settings__t}{time\+\_\+settings\+\_\+t}} \texorpdfstring{$\ast$}{*}time\+\_\+settings)
\begin{DoxyCompactList}\small\item\em Inicializa las alarmas de inicio y fin de funcionamiento del motor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static const char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{rtc_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}} = "{}RTC"{}
\item 
static \mbox{\hyperlink{structrtc__alarms__t}{rtc\+\_\+alarms\+\_\+t}} \mbox{\hyperlink{rtc_8c_a27b710d06dd027d535da94e798d0a819}{rtc\+\_\+alarms}}
\item 
static \mbox{\hyperlink{structtime__settings__t}{time\+\_\+settings\+\_\+t}} \mbox{\hyperlink{rtc_8c_ab2199ad93a3c4b4fa1de3d486346cba7}{alarm\+\_\+settings}}
\item 
static struct tm \mbox{\hyperlink{rtc_8c_a4b2b47c8b14e716db2bb270503eb09d2}{time\+\_\+start}}
\item 
static struct tm \mbox{\hyperlink{rtc_8c_a12c22a2f47ab452be111d558be82ac3d}{time\+\_\+stop}}
\end{DoxyCompactItemize}


\doxysubsection{Descripción detallada}
Funciones de lectura y escritura del RTC y alarmas. 

\begin{DoxyAuthor}{Autor}
Andrenacci -\/ Carra 
\end{DoxyAuthor}
\begin{DoxyVersion}{Versión}
2.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Fecha}
2025-\/11-\/06 
\end{DoxyDate}


Definición en el archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.



\label{doc-func-members}
\Hypertarget{rtc_8c_doc-func-members}
\doxysubsection{Documentación de funciones}
\Hypertarget{rtc_8c_ae9adc0a6f5c490088bf65676a23ef49e}\index{rtc.c@{rtc.c}!alarm\_start\_cb@{alarm\_start\_cb}}
\index{alarm\_start\_cb@{alarm\_start\_cb}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{alarm\_start\_cb()}{alarm\_start\_cb()}}
{\footnotesize\ttfamily \label{rtc_8c_ae9adc0a6f5c490088bf65676a23ef49e} 
void alarm\+\_\+start\+\_\+cb (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{arg}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Función programada como alarma para iniciar el funcionamiento del motor. 

Envía la señal al sistema para poder iniciar el funcionamiento del motor según la frecuencia de régimen, aceleración configuradas.


\begin{DoxyParams}[1]{Parámetros}
\mbox{\texttt{in}}  & {\em arg} & Sin uso. \\
\hline
\end{DoxyParams}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00212}{212}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_ae1c6ac7aa77f0274bbdb795eab58f081}\index{rtc.c@{rtc.c}!alarm\_stop\_cb@{alarm\_stop\_cb}}
\index{alarm\_stop\_cb@{alarm\_stop\_cb}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{alarm\_stop\_cb()}{alarm\_stop\_cb()}}
{\footnotesize\ttfamily \label{rtc_8c_ae1c6ac7aa77f0274bbdb795eab58f081} 
void alarm\+\_\+stop\+\_\+cb (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{arg}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Función programada como alarma para finalizar el funcionamiento del motor. 

Envía la señal al sistema para poder finalizar el funcionamiento del motor según la desaceleración configurada.


\begin{DoxyParams}[1]{Parámetros}
\mbox{\texttt{in}}  & {\em arg} & Sin uso. \\
\hline
\end{DoxyParams}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00233}{233}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_a044acdfeee0cbf154bb9679e46b9bcf9}\index{rtc.c@{rtc.c}!getTime@{getTime}}
\index{getTime@{getTime}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{getTime()}{getTime()}}
{\footnotesize\ttfamily \label{rtc_8c_a044acdfeee0cbf154bb9679e46b9bcf9} 
esp\+\_\+err\+\_\+t get\+Time (\begin{DoxyParamCaption}\item[{struct tm \texorpdfstring{$\ast$}{*}}]{current\+\_\+timeinfo}{}\end{DoxyParamCaption})}



Carga la hora actuak desde el RTC del ESP32. 

Lee la hora del RTC del ESP32 expresada en unix time y la convierte en un formato entendible por el usuario en la estructura {\ttfamily current\+\_\+timeinfo} 


\begin{DoxyParams}[1]{Parámetros}
\mbox{\texttt{in}}  & {\em current\+\_\+timeinfo} & Esturctura tm en donde se cargará la fecha y hora del sistema.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}

\begin{DoxyItemize}
\item ESP\+\_\+\+OK si carga la hora exitosamente.
\item ESP\+\_\+\+ERR\+\_\+\+INVALID\+\_\+\+ARG si {\ttfamily current\+\_\+timeinfo} es NULL 
\end{DoxyItemize}
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00124}{124}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_ae110c54d6d4dcbd67211a1ac02cdc222}\index{rtc.c@{rtc.c}!initRTC@{initRTC}}
\index{initRTC@{initRTC}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{initRTC()}{initRTC()}}
{\footnotesize\ttfamily \label{rtc_8c_ae110c54d6d4dcbd67211a1ac02cdc222} 
esp\+\_\+err\+\_\+t init\+RTC (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Inicializa el RTC en la hora 00\+:00\+:00. 

No es importante el día configurado para el sistema, pero carga la hora 0 de UNIX\+\_\+\+TIME.

\begin{DoxyReturn}{Devuelve}

\begin{DoxyItemize}
\item ESP\+\_\+\+OK siempre. 
\end{DoxyItemize}
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00092}{92}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_ab576cf2b5649a8f5af8c1eca26c1e01a}\index{rtc.c@{rtc.c}!program\_alarm@{program\_alarm}}
\index{program\_alarm@{program\_alarm}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{program\_alarm()}{program\_alarm()}}
{\footnotesize\ttfamily \label{rtc_8c_ab576cf2b5649a8f5af8c1eca26c1e01a} 
esp\+\_\+err\+\_\+t program\+\_\+alarm (\begin{DoxyParamCaption}\item[{esp\+\_\+timer\+\_\+handle\+\_\+t \texorpdfstring{$\ast$}{*}}]{timer\+\_\+handle}{, }\item[{void(\texorpdfstring{$\ast$}{*}}]{callback~}{)(void \texorpdfstring{$\ast$}{*}), }\item[{int}]{hour}{, }\item[{int}]{minute}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{name}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Función dedicada a programar la alarma según hour y minute. 

No distingue de inicio o fin de marcha, para ello se le pasa el puntero a función \textquotesingle{}callback\textquotesingle{} para la función de inicio o fin de marcha, el handler \textquotesingle{}timer\+\_\+handeler\textquotesingle{} y un nombre descriptivo. Los handlers de los timers son creados como tareas y no como interrupciones para poder utilizar las funciones .


\begin{DoxyParams}[1]{Parámetros}
\mbox{\texttt{out}}  & {\em timer\+\_\+handle} & Puntero de salida donde se devuelve el handle del timer creado. Debe ser no-\/\+NULL. El caller es responsable de detener y destruir el timer cuando ya no se utilice (esp\+\_\+timer\+\_\+stop / esp\+\_\+timer\+\_\+delete).\\
\hline
\mbox{\texttt{in}}  & {\em callback} & Puntero a función de tipo {\ttfamily void (\texorpdfstring{$\ast$}{*})(void \texorpdfstring{$\ast$}{*})} que se invocará cuando la alarma dispare. Se ejecuta en el contexto de la tarea interna de esp\+\_\+timer (no en ISR). Puede usar APIs no-\/\+ISR (colas, logs, etc.).\\
\hline
\mbox{\texttt{in}}  & {\em hour} & Hora en formato 24 h. Rango válido\+: 0–23.\\
\hline
\mbox{\texttt{in}}  & {\em minute} & Minutos. Rango válido\+: 0–59.\\
\hline
\mbox{\texttt{in}}  & {\em name} & Nombre descriptivo del timer (aparece en logs/diagnóstico). Debe apuntar a memoria de duración estática (p. ej., literal o {\ttfamily static const}).\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}

\begin{DoxyItemize}
\item ESP\+\_\+\+OK en caso de éxito.
\item ESP\+\_\+\+ERR\+\_\+\+INVALID\+\_\+\+ARG si {\ttfamily timer\+\_\+handle} es NULL, {\ttfamily callback} es NULL o {\ttfamily hour/{\ttfamily minute} están} fuera de rango.
\item ESP\+\_\+\+ERR\+\_\+\+INVALID\+\_\+\+STATE Si el RTC aún no fue inicializado
\item ESP\+\_\+\+ERR\+\_\+\+NO\+\_\+\+MEM si la allocación de memoria para los handlers falla 
\end{DoxyItemize}
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00171}{171}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_adb9ac05b0bcd1cc3769f8a9931d90c06}\index{rtc.c@{rtc.c}!rtc\_schedule\_alarms@{rtc\_schedule\_alarms}}
\index{rtc\_schedule\_alarms@{rtc\_schedule\_alarms}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{rtc\_schedule\_alarms()}{rtc\_schedule\_alarms()}}
{\footnotesize\ttfamily \label{rtc_8c_adb9ac05b0bcd1cc3769f8a9931d90c06} 
esp\+\_\+err\+\_\+t rtc\+\_\+schedule\+\_\+alarms (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structtime__settings__t}{time\+\_\+settings\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{time\+\_\+settings}{}\end{DoxyParamCaption})}



Inicializa las alarmas de inicio y fin de funcionamiento del motor. 

La hora y minuto cargada en time\+\_\+start es la que dará inicio al funcionamiento del motor, mientas que la cargada en time\+\_\+stop será la que finalizará el mismo.


\begin{DoxyParams}[1]{Parámetros}
\mbox{\texttt{in}}  & {\em time\+\_\+settings} & Esturctura \doxylink{structtime__settings__t}{time\+\_\+settings\+\_\+t} que contiene los horarios de alarma de inicio y fin. Además contiene la hora actual, una variable que no es utilizada por la función.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}

\begin{DoxyItemize}
\item ESP\+\_\+\+OK si Configura las alarmas exitosamente.
\item ESP\+\_\+\+FAIL si falla en la creación de las alarmas. 
\end{DoxyItemize}
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00137}{137}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_a18ec0d194dc994434090b873251093b0}\index{rtc.c@{rtc.c}!setTime@{setTime}}
\index{setTime@{setTime}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{setTime()}{setTime()}}
{\footnotesize\ttfamily \label{rtc_8c_a18ec0d194dc994434090b873251093b0} 
esp\+\_\+err\+\_\+t set\+Time (\begin{DoxyParamCaption}\item[{struct tm \texorpdfstring{$\ast$}{*}}]{setting\+\_\+time}{}\end{DoxyParamCaption})}



Inicializa el RTC en la hora cargada en setting\+\_\+time. 

No es importante el día configurado para el sistema, pero carga la hora 0 de UNIX\+\_\+\+TIME.


\begin{DoxyParams}[1]{Parámetros}
\mbox{\texttt{in}}  & {\em setting\+\_\+time} & Esturctura tm que es cargada en el RTC del ESP32 según su año, mes, día, hora, minuto y segundo.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}

\begin{DoxyItemize}
\item ESP\+\_\+\+OK si carga el horario correctamente.
\item ESP\+\_\+\+ERR\+\_\+\+INVALID\+\_\+\+ARG en caso de recibir un puntero NULL 
\end{DoxyItemize}
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00107}{107}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.



\label{doc-var-members}
\Hypertarget{rtc_8c_doc-var-members}
\doxysubsection{Documentación de variables}
\Hypertarget{rtc_8c_ab2199ad93a3c4b4fa1de3d486346cba7}\index{rtc.c@{rtc.c}!alarm\_settings@{alarm\_settings}}
\index{alarm\_settings@{alarm\_settings}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{alarm\_settings}{alarm\_settings}}
{\footnotesize\ttfamily \label{rtc_8c_ab2199ad93a3c4b4fa1de3d486346cba7} 
\mbox{\hyperlink{structtime__settings__t}{time\+\_\+settings\+\_\+t}} alarm\+\_\+settings\hspace{0.3cm}{\ttfamily [static]}}



Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00031}{31}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_a27b710d06dd027d535da94e798d0a819}\index{rtc.c@{rtc.c}!rtc\_alarms@{rtc\_alarms}}
\index{rtc\_alarms@{rtc\_alarms}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{rtc\_alarms}{rtc\_alarms}}
{\footnotesize\ttfamily \label{rtc_8c_a27b710d06dd027d535da94e798d0a819} 
\mbox{\hyperlink{structrtc__alarms__t}{rtc\+\_\+alarms\+\_\+t}} rtc\+\_\+alarms\hspace{0.3cm}{\ttfamily [static]}}



Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00030}{30}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}\index{rtc.c@{rtc.c}!TAG@{TAG}}
\index{TAG@{TAG}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{TAG}{TAG}}
{\footnotesize\ttfamily \label{rtc_8c_a5a85b9c772bbeb480b209a3e6ea92b4c} 
const char\texorpdfstring{$\ast$}{*} TAG = "{}RTC"{}\hspace{0.3cm}{\ttfamily [static]}}



Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00029}{29}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_a4b2b47c8b14e716db2bb270503eb09d2}\index{rtc.c@{rtc.c}!time\_start@{time\_start}}
\index{time\_start@{time\_start}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{time\_start}{time\_start}}
{\footnotesize\ttfamily \label{rtc_8c_a4b2b47c8b14e716db2bb270503eb09d2} 
struct tm time\+\_\+start\hspace{0.3cm}{\ttfamily [static]}}



Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00033}{33}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

\Hypertarget{rtc_8c_a12c22a2f47ab452be111d558be82ac3d}\index{rtc.c@{rtc.c}!time\_stop@{time\_stop}}
\index{time\_stop@{time\_stop}!rtc.c@{rtc.c}}
\doxysubsubsection{\texorpdfstring{time\_stop}{time\_stop}}
{\footnotesize\ttfamily \label{rtc_8c_a12c22a2f47ab452be111d558be82ac3d} 
struct tm time\+\_\+stop\hspace{0.3cm}{\ttfamily [static]}}



Definición en la línea \mbox{\hyperlink{rtc_8c_source_l00034}{34}} del archivo \mbox{\hyperlink{rtc_8c_source}{rtc.\+c}}.

